<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <title>Hello, world!</title>
  <script src="html5-qrcode.min.js"></script>
</head>
<body>
<div class="container">
  <h2>QR Code Scaner</h2>

  <div class="col-md-8">
    <div id="scanDiv">

    </div>
    <button class="btn btn-primary" onclick="scanStart()">掃描</button>
    <div id="resultDiv">

    </div>
  </div>

</div>
<script>

  function scanStart() {
    const html5QrCode = new Html5Qrcode(/* element id */ "scanDiv");
    html5QrCode.start(
      {facingMode: "environment"},
      {
        fps: 10,    // Optional frame per seconds for qr code scanning
        qrbox: 250  // Optional if you want bounded box UI
      },
      (decodedText, decodedResult) => {
        if (decodedText !== lastResult) {
          ++countResults;
          lastResult = decodedText;
          var str = JSON.stringify(decodedResult, null, 4);
          resultContainer.innerText = str;
          alert("掃描成功")
          html5QrcodeScanner.stop().then(ignore => {
            var ele = document.getElementById("qr-reader").style.visibility = "hidden";
          }).catch(err => {
            // Stop failed, handle it.
          });
        }
      },
      errorMessage => {
        // parse error, ignore it.
      })
      .catch(err => {
        // Start failed, handle it.
      });
  }

  docReady(function () {
    var resultContainer = document.getElementById('qr-reader-results');
    var lastResult, countResults = 0;

    function onScanSuccess(decodedText, decodedResult) {
      if (decodedText !== lastResult) {
        ++countResults;
        lastResult = decodedText;
      }
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

</body>
</html>
